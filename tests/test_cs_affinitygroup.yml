- hosts: localhost
  connection: local
  tasks:

# clean setup
  - cs_affinitygroup: name=test_ag state=absent

  - cs_affinitygroup: name=test_ag
    register: ag
  - assert:
      that:
      - ag|success
      - ag|changed
      - ag.name == "test_ag"

  - cs_affinitygroup: name=test_ag
    register: ag
  - assert:
      that:
      - ag|success
      - not ag|changed
      - ag.name == "test_ag"

  - cs_affinitygroup: name=test_ag state=absent
    register: ag
  - assert:
      that:
      - ag|success
      - ag|changed
      - ag.name == "test_ag"

  - cs_affinitygroup: name=test_ag state=absent
    register: ag
  - assert:
      that:
      - ag|success
      - not ag|changed
      - ag.name is undefined
